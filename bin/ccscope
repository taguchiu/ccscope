#!/usr/bin/env node

/**
 * CCScope (Claude Code Scope) - Interactive Conversation Browser
 * Command line entry point
 */

const path = require('path');
const CCLensApplication = require('../src/CCScope');

// Parse command line arguments
function parseArguments() {
  const args = process.argv.slice(2);
  const options = {
    debug: false,
    theme: 'default',
    language: 'en',
    help: false,
    daily: false
  };
  
  for (let i = 0; i < args.length; i++) {
    const arg = args[i];
    
    switch (arg) {
      case '--debug':
      case '-d':
        options.debug = true;
        break;
      case '--theme':
      case '-t':
        options.theme = args[++i] || 'default';
        break;
      case '--language':
      case '-l':
        options.language = args[++i] || 'en';
        break;
      case '--help':
      case '-h':
        options.help = true;
        break;
      case '--daily':
        options.daily = true;
        break;
      case '--version':
      case '-v':
        const packageJson = require('../package.json');
        console.log(`CCScope v${packageJson.version}`);
        process.exit(0);
        break;
    }
  }
  
  return options;
}

// Show help message
function showHelp() {
  console.log(`
üîç CCScope (Claude Code Scope) - Interactive Conversation Browser

Usage: ccscope [options]

Options:
  -d, --debug              Enable debug mode
  -t, --theme <theme>      Set theme (default, dark, light, minimal)
  -l, --language <lang>    Set language (en, ja)
  --daily                  Show daily conversation statistics
  -h, --help              Show this help message
  -v, --version           Show version information

Examples:
  ccscope
  ccscope --debug
  ccscope --theme dark
  ccscope --language ja
  ccscope --daily

Navigation:
  ‚Üë/‚Üì or k/j    Navigate up/down
  ‚Üê/‚Üí or h/l    Navigate left/right
  Enter         Select/Enter view
  Esc or q      Back/Exit
  h or ?        Help
  /             Search
  f             Filter
  s             Sort

More information: https://github.com/your-repo/ccscope
  `);
}

// Main entry point
async function main() {
  const options = parseArguments();
  
  if (options.help) {
    showHelp();
    return;
  }
  
  try {
    const app = new CCLensApplication();
    
    // Apply CLI options
    if (options.debug) {
      app.enableDebug();
    }
    
    if (options.theme !== 'default') {
      app.themeManager.setTheme(options.theme);
    }
    
    if (options.language !== 'en') {
      app.stateManager.setLanguage(options.language);
    }
    
    // Check for daily statistics mode
    if (options.daily) {
      await app.showDailyStatistics();
      return;
    }
    
    // Start the application
    await app.start();
    
  } catch (error) {
    console.error('‚ùå Failed to start CCScope:', error);
    process.exit(1);
  }
}

// Run the application
if (require.main === module) {
  main().catch(error => {
    console.error('‚ùå Fatal error:', error);
    process.exit(1);
  });
}